function Biltorvet(s){var p=s(document).find(".bdt .vehicle_search"),a=s(document).find(".bdt .vehicle_search_results"),t="",n=document.getElementById("bdt-loading-filters"),m=document.getElementById("frontpage_vehicle_search"),h=document.getElementById("vehicle_search_frontpage_button"),l=null,e=p.find(".lds-ring"),f=null,v=null,y=!1,g=document.getElementById("LeasingAlternativeName"),c={CompanyIds:null,Propellant:null,Makes:null,Models:null,BodyTypes:null,ProductTypes:null,VehicleStates:null,FullTextSearch:null,PriceTypes:null,CustomVehicleTypes:null,PriceMin:null,PriceMax:null,ConsumptionMin:null,ConsumptionMax:null,Start:null,Limit:null,OrderBy:null,Ascending:null};function i(e){var t=s(e).next(".select2-container").find(".select2-selection__rendered");s(t).parent().find(".select2-search__field").show(),s(t).parent().find(".select2-selection__label").remove(),s(e).parent().find(".selectDropDownLabel").show()}function r(e){if(s(e).hasClass("select2-hidden-accessible")){const t=[];return s(e).select2("data").forEach(e=>{e={val:e.id};t.push(e.val)}),t}}function o(e){s(e).trigger("change.select2");var t=s(e).next(".select2-container").find(".select2-selection__rendered"),n=s(t).children("li"),l=(s(t).show(),s(t).parent().find(".select2-selection__label").remove(),s(t).width()),a=-20;n.length?(s(t).parent().find(".select2-search__field").hide(),s(e).parent().find(".selectDropDownLabel").hide()):(s(t).parent().find(".select2-search__field").show(),s(e).parent().find(".selectDropDownLabel").show()),s(n).each(function(){a+=n.outerWidth()}),l<a?(s(t).hide(),s(t).parent().append('<span class="select2-selection__label">'+n.length+" valgte "+s(e).data("contenttype")+"</span>")):(s(t).show(),s(t).parent().find(".select2-selection__label").remove())}function d(){y?(v.bootstrapSlider("disable"),f.bootstrapSlider("disable")):(v.slider("disable"),f.slider("disable")),p.find("select").prop("disabled",!0);var e=document.getElementsByClassName("car-icon-container");0<e.length&&Array.from(e).forEach(function(e){e.classList.add("cvt-disable-clicking")})}function u(){e.hasClass("d-none")&&e.css("opacity",0).css("display","block").removeClass("d-none"),e.animate({opacity:1},1e3)}function b(){e.animate({opacity:0},200,function(){s(this).css("display","none").addClass("d-none")})}function T(){var e=s(document).find(".bdt .vehicle_search_results").find(".lds-ring-paging");e.hasClass("d-none")&&e.css("opacity",0).css("display","block").removeClass("d-none"),e.animate({opacity:1},1e3)}function S(){var e=s(document).find(".bdt .vehicle_search_results").find(".lds-ring-paging");g&&s('#select-orderby option:contains("Leasingpris")').text(g.innerText),e.animate({opacity:0},200,function(){s(this).css("display","none").addClass("d-none")})}function _(e,t){var n,l=[...p.find("select[name="+e+"]")[0].options].map(e=>e.value);(0<(n=l).filter((e,t)=>n.indexOf(e)!=t).length||t.length!==l.length)&&document.getElementById(e).options[0].remove()}function x(e){m?(h.setAttribute("data-labelpattern","Vis "+e.totalResults+" resultater"),h.innerText="Vis "+e.totalResults+" resultater"):p.find(".search").text(p.find(".search").data("labelpattern").replace("%u",e.totalResults));var t="";for(o in e.fullTextSearch)t+=e.fullTextSearch.value;p.find("input[name=fullTextSearch]").val(t),""!==t&&p.find("input[name=fullTextSearch]").removeAttr("disabled");var n="";for(o in e.companies)n+='<option value="'+e.companies[o].key+'">'+e.companies[o].value+"</option>";p.find("select[name=company]").find("option:not(:first-child)").remove().end().append(n),_("company",e.companies),""!==n&&p.find("select[name=company]").removeAttr("disabled");var l="";for(o in e.makes)l+='<option value="'+e.makes[o].name+'">'+e.makes[o].name+"</option>";p.find("select[name=make]").find("option:not(:first-child)").remove().end().append(l),_("make",e.makes),""!==l&&p.find("select[name=make]").removeAttr("disabled");var a="";for(o in e.models)a+='<option value="'+e.models[o].name+'">'+e.models[o].name+"</option>";p.find("select[name=model]").find("option:not(:first-child)").remove().end().append(a),_("model",e.models),""!==a&&p.find("select[name=model]").removeAttr("disabled");var i="";for(o in e.vehicleStates)i+='<option value="'+e.vehicleStates[o].name+'">'+e.vehicleStates[o].name+"</option>";p.find("select[name=vehicleState]").find("option:not(:first-child)").remove().end().append(i),_("vehicleState",e.vehicleStates),""!==i&&p.find("select[name=vehicleState]").removeAttr("disabled");var s="";for(o in e.priceTypes)g&&"Leasing"==e.priceTypes[o].name?s+='<option value="'+e.priceTypes[o].name+'">'+g.innerText+"</option>":s+='<option value="'+e.priceTypes[o].name+'">'+e.priceTypes[o].name+"</option>";p.find("select[name=priceType]").find("option:not(:first-child)").remove().end().append(s),_("priceType",e.priceTypes),""!==s&&p.find("select[name=priceType]").removeAttr("disabled");var c="";for(o in e.productTypes)c+='<option value="'+e.productTypes[o].name+'">'+e.productTypes[o].name+"</option>";p.find("select[name=productType]").find("option:not(:first-child)").remove().end().append(c),_("productType",e.productTypes),""!==c&&p.find("select[name=productType]").removeAttr("disabled");var r="";for(o in e.bodyTypes)r+='<option value="'+e.bodyTypes[o].name+'">'+e.bodyTypes[o].name+"</option>";p.find("select[name=bodyType]").find("option:not(:first-child)").remove().end().append(r),_("bodyType",e.bodyTypes),""!==r&&p.find("select[name=bodyType]").removeAttr("disabled");var o,d="";for(o in e.propellants)d+='<option value="'+e.propellants[o].name+'">'+e.propellants[o].name+"</option>";p.find("select[name=propellant]").find("option:not(:first-child)").remove().end().append(d),_("propellant",e.propellants),""!==d&&p.find("select[name=propellant]").removeAttr("disabled"),null!==v&&(y?v.bootstrapSlider(e.consumptionMin===e.consumptionMax?"disable":"enable"):v.slider(e.consumptionMin===e.consumptionMax?"disable":"enable")).data("slider").setAttribute("min",e.consumptionMin).setAttribute("max",e.consumptionMax).setValue([(null===e.values.consumptionMin?e:e.values).consumptionMin,(null===e.values.consumptionMax?e:e.values).consumptionMax],!0,!0),null!==f&&(y?f.bootstrapSlider(e.priceMin===e.priceMax?"disable":"enable"):f.slider(e.priceMin===e.priceMax?"disable":"enable")).data("slider").setAttribute("min",e.priceMin).setAttribute("max",e.priceMax).setValue([(null===e.values.priceMin?e:e.values).priceMin,(null===e.values.priceMax?e:e.values).priceMax],!0,!0);var u=document.getElementsByClassName("car-icon-container");0<u.length&&Array.from(u).forEach(function(e){e.classList.remove("cvt-disable-clicking")})}function k(){var e=-1===(e=f.data("slider").getValue()[0])?null:e,t=-1===(t=f.data("slider").getValue()[1])?null:t,n=-1===(n=v.data("slider").getValue()[0])?null:n,l=-1===(l=v.data("slider").getValue()[1])?null:l,e=(c={CompanyIds:r("#company")??null,FullTextSearch:""===p.find("input[name=fullTextSearch]").val()?null:[p.find("input[name=fullTextSearch]").val()],Propellants:r("#propellant")??null,Makes:r("#make")??null,Models:r("#model")??null,BodyTypes:r("#bodyType")??null,ProductTypes:r("#productType")??null,VehicleStates:r("#vehicleState")??null,PriceTypes:r("#priceType")??null,PriceMin:null!==f&&f.data("slider").getAttribute("min")!==e?e:null,PriceMax:null!==f&&f.data("slider").getAttribute("max")!==t?t:null,ConsumptionMin:null!==v&&v.data("slider").getAttribute("min")!==n?n:null,ConsumptionMax:null!==v&&v.data("slider").getAttribute("max")!==l?l:null,Start:null,Limit:null,OrderBy:""===a.find("select[name=orderBy]").val()?null:a.find("select[name=orderBy]").val(),Ascending:"asc"===a.find("select[name=ascDesc]").val()},GetCustomVehicleType());e&&(c.CustomVehicleTypes=[e])}s(document).ready(function(e){s(".multiple").select2({dropdownParent:s(".vehicle_search"),containerCssClass:".multiple"});var t="";s(".quicksearch").select2({ajax:{url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/quicksearch",method:"POST",dataType:"json",delay:250,data:function(e){return t=e.term,{action:"vehicle_quicksearch",q:[e.term]}},processResults:function(e){return{results:e.vehicles}},cache:!0},minimumInputLength:2,placeholder:"Søg efter køretøjer...",language:{noResults:function(){return"Søgningen '"+t+"' gav ingen resultater."},inputTooShort:function(e){return"Indtast "+e.minimum+" eller flere tegn for at starte din søgning"},inputTooLong:function(e){return"Du har indtastet for mange tegn. "+e.maximum+" er maks antal tegn der kan indtastes"},errorLoading:function(){return"Der er desværre sket en fejl - prøv venligst igen"},searching:function(){return"Søger..."}},escapeMarkup:function(e){return e},templateResult:Vehicles,templateSelection:VehiclesSelection})}),m&&(t=document.getElementById("root_url").textContent),this.Init=function(){var e;s.bootstrapSlider&&(y=!0),0<s("#priceRange").length&&(e={id:s(this).attr("id"),min:0,max:1e7,range:!0,value:[0,1e7],step:1,tooltip:"hide"},f=y?s("#priceRange").bootstrapSlider(e):s("#priceRange").slider(e)),0<s("#consumptionRange").length&&(e={id:s(this).attr("id"),min:0,max:10,range:!0,value:[0,10],step:1,tooltip:"hide"},v=y?s("#consumptionRange").bootstrapSlider(e):s("#consumptionRange").slider(e)),this.ReloadUserFilterSelection(!0),this.VehicleSearch(!0),this.PlaceholderShuffler()},this.PlaceholderShuffler=function(){fullTextSearch=p.find("input[name=fullTextSearch]");var e=this,t=["Søg på mærke, model, farve, udstyr mm...          ","Søg på stationcar anhængertræk...                        ","Søg på hvid varevogn...                                  ","Søg på diesel SUV...                                     "][Math.floor(4*Math.random())],n=0,l=setInterval(function(){n===t.length?(clearInterval(l),setTimeout(()=>e.PlaceholderShuffler(),400)):(s(".select2-search__field").attr("placeholder",t.substr(0,n+1)),fullTextSearch.attr("placeholder",t.substr(0,n+1)),n++)},100)},this.ReloadUserFilterSelection=function(e){0<p.length&&(null!==l&&l.abort(),u(),k(),d(),l=s.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/filteroptions",method:"POST",dataType:"json",data:{action:"get_filter_options",filter:e?null:c},cache:!1,success:function(n){var e;x(n),n.values&&(n.values.companyIds&&n.values.companyIds[0]?(s("#company").val(n.values.companyIds),o(s("#company"))):i("#company"),n.values.fullTextSearch&&n.values.fullTextSearch[0]&&p.find("input[name=fullTextSearch]").val(n.values.fullTextSearch[0]),n.values.makes&&n.values.makes[0]?(s("#make").val(n.values.makes),o(s("#make"))):i("#make"),n.values.models&&n.values.models[0]?(s("#model").val(n.values.models),o(s("#model"))):i("#model"),n.values.propellants&&n.values.propellants[0]?(s("#propellant").val(n.values.propellants),o(s("#propellant"))):i("#propellant"),n.values.bodyTypes&&n.values.bodyTypes[0]?(s("#bodyType").val(n.values.bodyTypes),o(s("#bodyType"))):i("#bodyType"),n.values.productTypes&&n.values.productTypes[0]?(s("#productType").val(n.values.productTypes),o(s("#productType"))):i("#productType"),n.values.vehicleStates&&n.values.vehicleStates[0]?(s("#vehicleState").val(n.values.vehicleStates),o(s("#vehicleState"))):i("#vehicleState"),n.values.priceTypes&&n.values.priceTypes[0]?(s("#priceType").val(n.values.priceTypes),o(s("#priceType"))):i("#priceType"),n.values.customVehicleTypes)&&n.values.customVehicleTypes[0]&&0<(e=document.getElementsByClassName("car-icon-container")).length&&Array.from(e).forEach(function(e){var t;n.values.customVehicleTypes[0]===e.dataset.customVehicleType&&(t="cvt-checkmark-"+e.dataset.customVehicleType,s('[name="'+t+'"]')[0].style.display="",e.classList.add("cvt-selected"))})},complete:function(){l=null,b(),S(),n.classList.remove("hide-bdt");var e=new URLSearchParams(window.location.search);e.has("scroll")&&"true"===e.get("scroll")&&(s("html, body").animate({scrollTop:s(".vehicle-row").offset().top-150},500),e=location.href,window.history.pushState({},"",e.replace("?scroll=true","")))}}))},this.ResetFilters=function(){return s.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/resetfilteroptions",method:"POST",dataType:"json",data:{action:"reset_filter_options"},cache:!1,success:function(e){x(e),s(".multiple").each(function(e,t){var n=s(t).next(".select2-container").find(".select2-selection__rendered");s(n).parent().find(".select2-selection__label").remove(),s(t).parent().find(".selectDropDownLabel").show()})},complete:function(){b()}})},this.ResetFilter=function(){u(),d(),c=null;var e,t=document.querySelector(".cvt-selected");null!==t&&(e=t.dataset.customVehicleType,s('[name="'+("cvt-checkmark-"+e)+'"]')[0].style.display="none",t.classList.remove("cvt-selected")),this.ResetFilters()},this.StartVehicleSearch=function(){u(),s.when(this.VehicleSearch()).then(function(){s("html, body").animate({scrollTop:s(".vehicle-row").offset().top-150},500)})},this.VehicleSearch=function(e){return s.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/search",method:"POST",dataType:"json",data:{action:"vehicle_search",filter:e?null:c},cache:!1,success:function(e){s("#bdt_vehicle_search_results").html(e)},complete:function(){S(),b()}})},this.SaveUserFilterSettings=function(){u(),k(),u(),s.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/filteroptions/savefilter",method:"POST",dataType:"json",data:{action:"save_filter",filter:c},cache:!1,success:function(e){window.location.href=t+"/?scroll=true"},complete:function(){b()}}),b()},this.StartOrderByAndAscDesc=function(){T(),k(),c.OrderBy=null===s("#select-orderby").val()?null:s("#select-orderby").val(),c.Ascending="asc"===s("#select-asc-desc").val(),s.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/search",method:"POST",dataType:"json",data:{action:"vehicle_search",filter:c},cache:!1,success:function(e){s("#vehicle_search_results").html(e)},complete:function(){S()}})},this.PagingFetchMore=function(){{T(),document.querySelectorAll(".animate__animated").forEach(e=>{e.classList.remove("animate__animated")});const i=document.querySelector("#paging-button");document.querySelector("#cvt-selected");var t=parseInt(i.dataset.currentPage),n=parseInt(i.dataset.amountOfPages),l=parseInt(i.dataset.limit),a=parseInt(i.dataset.end),e=GetCustomVehicleType();e&&(c.CustomVehicleTypes=[e]),s.ajax({url:ajax_config.restUrl+"autoit-dealer-tools/v1/vehiclesearch/search_paging",method:"POST",dataType:"json",data:{action:"vehicle_search_paging",filter:c,currentPage:t,start:a,limit:l},cache:!1,success:function(e){document.querySelector("#vehicle-row").innerHTML+=e,n!==t+1?(i.dataset.currentPage=String(t+1),i.dataset.end=String(a+l)):i.remove()},complete:function(){S()}})}},this.Init()}function GetCustomVehicleType(){var e=document.querySelector(".cvt-selected");if(null!==e)return e.dataset.customVehicleType}function FormatPrice(e,t){return-1===e?e:e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")+(t?",-":"")}function Vehicles(e){var t,n;return e.loading?"Søger...":(t=null!==e.cashPrice?"Kontantpris "+e.cashPrice:null!==e.leasingPrice?"Leasingpris "+e.leasingPrice:null!==e.financePrice?"Finansieringspris "+e.financePrice:"Ring for pris",30<(n=e.variant).length&&(n=n.slice(0,27)+"..."),"<div class='bdt_intellisense-list'><a href='"+e.uri+"'><span class='bdt_intellisense-list-image'><img src='"+e.vehicleImage+"' width='110px' alt='"+e.makeName+"'/></span><span class='bdt_intellisense-list-data'><span class='bdt_intellisense-list-name'>"+e.makeName+" "+e.model+"<br/><span>"+n+"</span></span><span class='bdt_intellisense-list-price'>"+t??"</span></span></span></a></div>")}function VehiclesSelection(e){return e.makeModelVariant}jQuery(function(i){var s=new Biltorvet(i);i(document).on("change",".bdtSlider",function(e){var t=e.value.newValue[0],n=e.value.newValue[1];"priceRange"===i(e.target).attr("id")&&(t=FormatPrice(t,!1),n=FormatPrice(n,!0)),-1===t&&(t=""),-1===n&&(n=""),i(this).closest(".bdtSliderContainer").find(".bdtSliderMinVal").text(t).end().find(".bdtSliderMaxVal").text(n)}).on("slideStop",".bdtSlider",function(e){s.ReloadUserFilterSelection(!1)}).on("click",".bdt .reset",function(e){e.preventDefault(),s.ResetFilter()}).on("change",".bdt .multiple",function(e){e.preventDefault();var t=i(e.target).next(".select2-container").find(".select2-selection__rendered"),n=i(t).children("li");1<n.length&&(n[n.length-1].style.display="none"),n.length?(i(t).parent().find(".select2-search__field").hide(),i(e.target).parent().find(".selectDropDownLabel").hide()):(i(t).parent().find(".select2-search__field").show(),i(e.target).parent().find(".selectDropDownLabel").show()),s.ReloadUserFilterSelection(!1)}).on("click",".bdt .search",function(e){e.preventDefault(),s.StartVehicleSearch()}).on("click","#vehicle_search_frontpage_button",function(e){e.preventDefault(),s.SaveUserFilterSettings()}).on("change",".searchFilter select",function(e){e.preventDefault(),s.StartOrderByAndAscDesc()}).on("click",".bdt .paging-button",function(e){e.preventDefault(),s.PagingFetchMore()}).on("click",".bdt .car-icon-container",function(e){e.preventDefault();var t,e=e.target.closest(".car-icon-container"),n=e.dataset.customVehicleType,n=i('[name="'+("cvt-checkmark-"+n)+'"]'),l=(e.classList.value.includes("cvt-selected")?(n[0].style.display="none",e.classList.remove("cvt-selected")):(0<(t=document.getElementsByClassName("cvt-selected")).length&&(l=t[0].dataset.customVehicleType,i('[name="'+("cvt-checkmark-"+l)+'"]')[0].style.display="none",t[0].classList.remove("cvt-selected")),n[0].style.display="",e.classList.add("cvt-selected")),i(this).closest(".bdt .vehicle_search"));l.find("input[name=fullTextSearch]").val(""),l.find("select[name=company]").val(""),l.find("select[name=vehicleState]").val(""),l.find("select[name=make]").val(""),l.find("select[name=model]").val(""),l.find("select[name=bodyType]").val(""),l.find("select[name=productType]").val(""),l.find("select[name=priceType]").val(""),l.find("select[name=propellant]").val(""),l.find("select[name=priceMinMax]").val(""),l.find("select[name=priceMinMax]").val(""),l.find("select[name=consumptionMin]").val(""),l.find("select[name=consumptionMax]").val(""),s.ReloadUserFilterSelection(!1)}).on("blur",".fullTextSearch",function(){s.ReloadUserFilterSelection(!1)}),i(document).ready(function(){let t=i(".paging-button-scroll")[0],n=null;function l(){s.PagingFetchMore()}function a(e){e.forEach(e=>{e.isIntersecting&&l()})}function e(){var e=i(".paging-button-scroll")[0];e!==t&&(n&&(n.disconnect(),n=null),t=e)&&(n=new IntersectionObserver(a,{threshold:.5})).observe(t)}e(),i(window).on("scroll",e),i(t).on("click",l)})});